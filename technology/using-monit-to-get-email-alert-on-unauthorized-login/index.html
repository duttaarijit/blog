<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Using Monit to get email alert on unauthorized login &#8211; eLitmus Blog</title>
<meta name="description" content="We learn new things everyday, and we document our learnings here...">

<meta name="keywords" content="ssh, monit, alert">

<!-- Twitter Cards -->
    <meta name="twitter:card" content="summary">    
<meta name="twitter:title" content="Using Monit to get email alert on unauthorized login">
<meta name="twitter:description" content=" Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server">
<meta name="twitter:site" content="@elitmus">

    
        
            <meta name="twitter:creator" content="@shireeshj">
        
    

    

    

    

    

    

    

    




<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:image" content="/blog/images/blog_logo_taglinedorange.png"/>
<meta property="og:type" content="article">
<meta property="og:title" content="Using Monit to get email alert on unauthorized login">
<meta property="og:description" content="Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server">
<meta property="og:url" content="/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/">

<meta property="og:site_name" content="eLitmus Blog">







<link rel="canonical" href="https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="eLitmus Blog Feed">


	<link rel="author" href="https://plus.google.com/+eLitmus?rel=author">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Icons -->
<!-- apple touch icons -->
<link rel="apple-touch-icon" sizes="57x57" href="/blog/images/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/blog/images/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/blog/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/blog/images/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/blog/images/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/blog/images/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/blog/images/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/blog/images/apple-touch-icon-152x152.png">
<!-- Favicons default 16x16 -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="/blog/favicon.ico">

<!-- Favicons others -->
<link rel="icon" type="image/png" href="/blog/images/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/blog/images/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/blog/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/blog/images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/blog/images/favicon-32x32.png" sizes="32x32">

<!-- Icons for Windows 8 Tiles -->
<meta name="msapplication-TileColor" content="#ffffff"/>
<meta name="msapplication-TileImage" content="/blog/images/mstile-144x144.png">

<!-- For all browsers -->


<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:600,300,300italic|The+Girl+Next+Door" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Source+Code+Pro:300' rel='stylesheet' type='text/css'>

<meta http-equiv="cleartype" content="on">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap.min.css">
<link rel="stylesheet" href="/blog/assets/css/main.min.css">
<!-- <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->

<!-- Optional theme -->
<link rel="stylesheet" type="text/css" href="/blog/assets/css/bootstrap-theme.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="/blog/assets/css/font-elitmuslogo.css"/>

<link rel="stylesheet" href="/blog/assets/css/customize.css">

<!-- <link rel="stylesheet" href="/blog/assets/css/demo.css"> -->

<link rel="stylesheet" href="/blog/assets/css/forkit.css">



</head>

<body id="post">


  <header class="headroom">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/blog/"><img src="/blog/images/blog_logo_taglinedorange.png" alt="eLitmus Blog logo"/></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-left">
        <li>
          <div class="dropdown search-box-margin">
            <div class="input-group">
                
                
   
                <input data-toggle="dropdown" placeholder="Search...." id="search-box" class="input-sm search-input">
                <div class="dropdown-menu list-group" id="search-dropdown" >
                  <a role='presentation' class='search-results list-group-item'> Type more.... </a>
                </div>
            </div>
          </div>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right nav-icon-size-reduce">
          
          <li>
            
              <a href="/blog/"><i class="fa fa-home"></i> Home</a>
             
          </li>
          
          <li>
            
              <a href="/blog/posts/"><i class="fa fa-file-text-o"></i> Posts</a>
             
          </li>
          
          <li>
            
              <a href="//www.elitmus.com/"><i class="el el-elitmuslogo"></i> eLitmus</a>
             
          </li>
          
          <li><a href="/blog/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss"></i> Feed</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
</header>






<!-- 

  <div class="search-wrapper">
    <div class="search-form">
      <input type="text" class="search-field" placeholder="Search...">
      <i class="icon-remove-sign icon-2x"></i>
      <ul class="search-results post-list"></ul> --><!-- /.search-results -->
    <!-- </div> --><!-- /.search-form -->
  <!-- </div> --><!-- ./search-wrapper -->
<!--  --> 





  

  <div class="container-fluid">

  <div class="row">


    
    <div class="col-md-2">

    </div>
      <div class="col-md-8">
        

        <div id="main" role="main" class="marginal">
          <article class="hentry">
            
            <div >
              <header>

                <span class="entry-tags">
                  
                    <a href="/blog/tags/#ssh" title="Pages tagged ssh">ssh</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#monit" title="Pages tagged monit">monit</a>
                    &nbsp;&bull;&nbsp;
                  
                    <a href="/blog/tags/#alert" title="Pages tagged alert">alert</a>
                    
                  

                  <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Using Monit to get email alert on unauthorized login&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>

                </span>
              
                
                  <h1 class="no-padding">Using Monit to get email alert on unauthorized login</h1>
                
              </header>
            </div>
           
            <div>
                <div>
                  <span class='label label-warning'> <a href="/blog/categories/technology/index.html" > technology </a></span>
                </div>
              
                <div class='pull-left date-show'>
                  <span class="entry-date date published"><time datetime="2014-06-04T00:00:00+05:30"><i class="fa fa-calendar"></i> June 04, 2014</time></span>&nbsp;

                    
                </div>
                <div class='pull-right date-show'>
                  <span>
                    <a href="/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" rel="bookmark" title="Using Monit to get email alert on unauthorized login">
                      <i class="fa fa-link"></i> Permalink
                    </a>
                  </span>
                </div>
                <br/>
                <div class="panel panel-default">
                  <div class="panel-heading ">
                    <h3 class="panel-title">TL;DR</h3>
                  </div>
                  <div class="panel-body">
                    <aside>Apart from process monitoring, monit can also send alert messages on certain events. This feature can be used to get notified whenever someone logs into your unix/linux server</aside>
                  </div>
                </div>

                  
                
                <div class="post-content-justify">
                  <p>For a long time, we had our own custom written perl script to alert us whenever someone logged into our production servers from an ip address we do not recognize (not whitelisted). The script looked somewhat like this…</p>

<figure class="highlight"><pre><code class="language-perl" data-lang="perl"><span></span><span class="ch">#!/usr/bin/perl</span>
<span class="c1"># script file: alert_on_login.pl</span>
<span class="c1">#</span>
<span class="k">my</span> <span class="nv">$login_str</span> <span class="o">=</span> <span class="s">&quot;Accepted publickey&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$whitelist_ip</span> <span class="o">=</span> <span class="s">&quot;122.123.123.111&quot;</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">sendEmail</span>
<span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$from</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">$sendmail</span> <span class="o">=</span> <span class="s">&#39;/usr/lib/sendmail&#39;</span><span class="p">;</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">MAIL</span><span class="p">,</span> <span class="s">&quot;|$sendmail -oi -t&quot;</span><span class="p">);</span>
        <span class="k">print</span> <span class="n">MAIL</span> <span class="s">&quot;From: $from\n&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="n">MAIL</span> <span class="s">&quot;To: $to\n&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="n">MAIL</span> <span class="s">&quot;Subject: $subject\n\n&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="n">MAIL</span> <span class="s">&quot;$message\n&quot;</span><span class="p">;</span>
        <span class="nb">close</span><span class="p">(</span><span class="n">MAIL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">while</span> <span class="p">(</span><span class="o">&lt;&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">grep</span><span class="p">(</span><span class="sr">/$login_str/</span><span class="p">,</span> <span class="nv">$_</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">grep</span><span class="p">(</span><span class="sr">/$whitelist_ip/</span><span class="p">,</span> <span class="nv">$_</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">print</span> <span class="nv">$_</span><span class="p">;</span>
                <span class="nb">chomp</span> <span class="nv">$_</span><span class="p">;</span>
                <span class="nv">@arr</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">);</span>
                <span class="n">sendEmail</span><span class="p">(</span><span class="s">&#39;recepient1@elitmus.com, recepient2@elitmus.com&#39;</span><span class="p">,</span>
                          <span class="s">&#39;monit@elitmus.com&#39;</span><span class="p">,</span>
                          <span class="s">&#39;Server login from &#39;</span> <span class="o">.</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                          <span class="nv">$_</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>All we needed to do was to run this script in the background as a daemon, and it would send us an email alert whenever someone logged in successfully. As root user start the script like this:</p>

<pre><code>  # (perl alert_on_login.pl /var/log/auth.log &amp;)
</code></pre>

<p>Ever since we started using <a href="https://mmonit.com/monit/">monit</a> for the usual purpose (monitoring processes), we have also entrusted <a href="https://mmonit.com/monit/">monit</a> to do the job of the above perl script. <a href="https://mmonit.com/monit/">Monit</a> makes this super simple…</p>

<p><a href="https://mmonit.com/monit/">Monit</a> is a popular opensource process monitoring tool. It is used mostly for monitoring health of any linux process and take necessary action if any of the set parameters are breached. Monit can restart a process if the process failed for some reason. Monit can also notify you of incidents and actions taken.</p>

<p><a href="https://mmonit.com/monit/documentation/monit.html#alert_messages">See this</a> to learn more about <a href="https://mmonit.com/monit/">monit’s</a> alert capabilities.</p>

<p><a href="https://mmonit.com/monit/">Monit’s</a> global configuration file is usually /etc/monit/monitrc. Here is what <a href="https://mmonit.com/monit/">monit</a> needs to be told about how to send email alerts:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>...
<span class="c1"># This is our SMTP server settings. The complete syntax is</span>
<span class="c1"># SET MAILSERVER &lt;hostname [PORT] [USERNAME] [PASSWORD] [using SSLAUTO|SSLV2|SSLV3|TLSV11|TLSV12] [CERTMD5 checksum]&gt;, ...</span>
<span class="c1">#          [with TIMEOUT X SECONDS]</span>
<span class="c1">#          [using HOSTNAME hostname]</span>
<span class="c1">#</span>
<span class="c1"># But for our purpose, localhost is good enough</span>
SET mailserver localhost

<span class="c1"># This is the email template for alert messages</span>
SET mail-format <span class="o">{</span>
  from: monit@elitmus.com
  subject: <span class="nv">$SERVICE</span> <span class="nv">$EVENT</span> at <span class="nv">$DATE</span>
  message: Monit <span class="nv">$ACTION</span> <span class="nv">$SERVICE</span> at <span class="nv">$DATE</span> on <span class="nv">$HOST</span>: <span class="nv">$DESCRIPTION</span>.
           Yours sincerely,
           monit
<span class="o">}</span>

<span class="c1"># Alerts can be triggered for various reasons. Successful ssh login is just one of those reasons.</span>
<span class="c1"># Since this is a global configuration, we can tell monit to not send alerts for certain events</span>
<span class="c1">#  We also specify the email address of the recepient who will receive the alerts</span>

<span class="nb">set</span> alert recepient1@elitmus.com NOT ON <span class="o">{</span> action, instance, pid, ppid, nonexist <span class="o">}</span>
...</code></pre></figure>

<p>And then we add this config file <code>ssh_logins.conf</code> specific to sshd related stuff:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>check file ssh_logins with path /var/log/auth.log
  ignore match <span class="s2">&quot;/etc/monit/whitelist_ips.regex&quot;</span>
  <span class="k">if</span> match <span class="s2">&quot;Accepted publickey&quot;</span> <span class="k">then</span> alert</code></pre></figure>

<p>Notice how we tell <a href="https://mmonit.com/monit/">monit</a> to ignore logins from known ip addresses. We can now store all whitelist ip addresses in a separate file <code>/etc/monit/whitelist_ips.regex</code>, one address per line.</p>

<p><strong>Note:</strong> We have disabled password based login and hence do not monitor for passworded logins. If you use passworded login, you should change <code>"Accepted publickey"</code> to <code>"Accepted password"</code></p>

<p>Happy monitoring!</p>


                </div>
                <div class="entry-tags">
                  <div class=' social-sharing pull-right'>        
  
    <span class="social-share-facebook">
      <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square fa-lg"></i> Like</a>
    </span>&nbsp;&nbsp;
    <span class="social-share-twitter">
       <a href="https://twitter.com/share?hashtags=technology&text=Using Monit to get email alert on unauthorized login&via=elitmus" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square  fa-lg"></i></i> Tweet</a>
    </span>&nbsp;&nbsp;
     
</div>
                </div>
                <div class="clearfix"><br/></div>

                <div class="panel panel-default">

  
    
      <div class="panel-body">
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-6 col-md-4">
              <center>
                <img src="/blog/images/shireeshj.png" alt="Shireesh Jayashetty photo" class="author-photo img-circle img-responsive"/>
                <span class="author vcard"><span class="fn">Shireesh Jayashetty</span></span>

                <div class="nav-icon-size-reduce social-icons">
                  
                    <a href="http://twitter.com/shireeshj"  title="Shireesh Jayashetty on Twitter"  target="_blank"><i class="fa fa-twitter "></i></a>
                  
                  
                  
                  

                  
                    <a href="http://linkedin.com/in/shireeshj" title="Shireesh Jayashetty on LinkedIn" target="_blank"><i class="fa fa-linkedin "></i></a>
                  

                  

                  

                  

                  
                    <a href="http://github.com/shireeshj" title="Shireesh Jayashetty on Github" target="_blank"><i class="fa fa-github "></i></a>
                  

                     
                </div><!-- /.social-icons -->
              </center>
            </div>

            <!-- Add the extra clearfix for only the required viewport -->
            <div class="clearfix visible-xs"></div>

            <div class="col-md-8">
              
                <span class="author-bio">Shireesh heads technology at eLitmus. He is generally curious about things, especially technology. His curiosity almost cost him his first job when he hacked into a customer's system to gain unauthorized internet access (mid '90s). He was lucky, his employer saw this as a potential rather than a threat.</span>
              
            </div>
          </div>
        </div>
      </div>

  

  

  

  

  

  

  

  

</div>
                <div id='discourse-comments'></div>

<script type="text/javascript">
  DiscourseEmbed = { discourseUrl: 'https://adda.elitmus.com/',
                     discourseEmbedUrl: 'https://www.elitmus.com/blog/technology/using-monit-to-get-email-alert-on-unauthorized-login/'
                   };


  (function() {
    var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
    d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
  })();
</script>


                
              </div><!-- /.entry-content -->
            </div><!-- /.entry-wrapper -->

          </article>
            <nav class="navbar nav-justified" role="navigation">
              <ul class="pager">
                
                  <li class="previous showElem"><a href="/blog/technology/gotchas-while-syntactically-translating-aes-encryption-logic-from-php-to-ruby/" title="Gotcha's while syntactically translating AES encryption logic from PHP to Ruby">&larr;<span class="showPrevNex"> Previous </span> </a></li>
                
                
                  <li class="next showElem"><a href="/blog/technology/how-we-host-our-blog-on-github-pages-and-yet-serve-it-from-our-own-sub-url/" title="How we host our blog on GitHub pages and yet serve it from our own Sub-URL"> <span class='showPrevNex'> Next </span> &rarr; </a></li>
                
              </ul>
            </nav>
        
        </div><!-- /#main -->

      <!--/col-md-2 -->
      <div class="col-md-2">

      </div>

    </div><!-- /row -->
    </div>
    <div class="footer-color">
      <footer role="contentinfo">
        <center>
            <span class='footer-text'>
    &copy;  2005-<script> document.write(new Date().getFullYear()) </script>, eLitmus.com. | <a class='footer-text' href="/terms_of_use/">Terms of Use</a> &middot; <a  class='footer-text' href="/privacy_policy/">Privacy Policy</a>

  </span>
        </center>
      </footer>
    </div><!-- /.footer-wrapper -->
    

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-707704-1', 'elitmus.com');
	  ga('send', 'pageview');
	</script>



<!-- Load Modernizr -->
<script src="/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- adding jquery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/blog/assets/js/vendor/jquery-2.1.1.min.js"><\/script>')</script>
<!-- end of jquery -->
<script src="/blog/assets/js/scripts.min.js"></script>
<script src="/blog/assets/js/lunr.min.js"></script>
<script src="/blog/assets/js/lunr-search.js"></script>
<script src="/blog/assets/js/plugins/headroom.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/blog/assets/js/vendor/forkit.js"></script>
  

  </body>
</html>
